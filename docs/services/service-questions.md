# Service Documentation - Clarification Questions

## Auth Service Questions

### 1. Service Tokens vs JWT Tokens
- **Question**: How are service tokens different from JWT tokens? How are they generated and validated?
- **Context**: Notification Service mentions service tokens for service-to-service auth, but Auth Service docs only cover JWT
- **Options**:
  - a) Service tokens are long-lived JWT tokens with special claims
  - b) Service tokens are separate API keys stored in database
  - c) Service tokens are shared secrets configured per service
- **Recommendation**: Option (a) - long-lived JWT with service identifier claim

### 2. Token Expiration and Refresh
- **Question**: What are the token expiration times and refresh mechanism?
- **Context**: Docs mention expiration but don't specify durations
- **Questions**:
  - JWT token expiration: 1 hour? 24 hours? Configurable?
  - Refresh token expiration: 7 days? 30 days?
  - Can tokens be refreshed before expiration?
  - What happens when refresh token expires?

### 3. Password Requirements
- **Question**: What are the password strength requirements?
- **Context**: Docs mention "password strength requirements" but don't specify
- **Questions**:
  - Minimum length? (e.g., 8 characters)
  - Complexity requirements? (uppercase, lowercase, numbers, symbols)
  - Password history? (can't reuse last N passwords)
  - Password expiration? (must change after X days)

### 4. System User Creation
- **Question**: How does Wiki Service create/find the "admin" system user?
- **Context**: Wiki sync utility needs admin user for AI-written pages
- **Options**:
  - a) Wiki calls Auth Service endpoint to create system user
  - b) Wiki creates user directly in database (bypassing Auth Service)
  - c) Admin user is pre-created during setup
  - d) Wiki uses special endpoint: `POST /api/users/system` with service token
- **Recommendation**: Option (d) - special endpoint for system user creation

### 5. Logout Functionality
- **Question**: Is there a logout endpoint? How does token invalidation work?
- **Context**: Docs mention "logout" but no endpoint defined
- **Questions**:
  - `POST /api/auth/logout` endpoint?
  - Does logout invalidate token immediately?
  - Token blacklist for invalidated tokens?
  - Or just client-side token deletion?

### 6. Token Revocation
- **Question**: How does token revocation work?
- **Context**: Docs mention "token revocation capability" but not implemented
- **Questions**:
  - Revoke single token?
  - Revoke all user tokens?
  - Revoke by user ID?
  - Token blacklist table?

### 7. Email Verification
- **Question**: Is email verification required for registration?
- **Context**: Not mentioned in docs
- **Options**:
  - a) No email verification (simple registration)
  - b) Email verification required (send verification email)
  - c) Optional email verification
- **Recommendation**: Option (a) for MVP, add (b) later

### 8. Rate Limiting
- **Question**: Should auth endpoints have rate limiting?
- **Context**: Not mentioned in docs
- **Questions**:
  - Rate limit login attempts? (prevent brute force)
  - Rate limit registration? (prevent spam)
  - Rate limit token refresh?
  - Limits: e.g., 5 login attempts per minute?

### 9. Session Management
- **Question**: How does session management work beyond JWT tokens?
- **Context**: Docs mention "session management" but JWT is stateless
- **Questions**:
  - Multiple concurrent sessions per user?
  - Track active sessions?
  - Session timeout?
  - Or purely stateless with JWT?

## Notification Service Questions

### 1. Service Token Authentication
- **Question**: How are service tokens generated and validated?
- **Context**: Docs mention service tokens but not how they work
- **Questions**:
  - Generated by Auth Service?
  - Stored in database?
  - Validated by Auth Service or Notification Service?
  - Format: JWT with special claims? API key? Shared secret?

### 2. Notification Delivery Method
- **Question**: How are notifications delivered to users?
- **Context**: Docs don't specify delivery mechanism
- **Options**:
  - a) Polling: Client polls `/api/notifications` periodically
  - b) WebSocket: Real-time push notifications
  - c) Server-Sent Events (SSE): One-way push from server
  - d) Hybrid: Polling for initial load, WebSocket for updates
- **Recommendation**: Option (d) - polling for MVP, add WebSocket later

### 3. Notification Retention
- **Question**: How long are notifications kept?
- **Context**: Not mentioned in docs
- **Questions**:
  - Keep all notifications indefinitely?
  - Auto-delete after X days? (e.g., 30 days, 90 days)
  - User can delete manually?
  - Archive old notifications?

### 4. Bulk Operations
- **Question**: Are there bulk operations for notifications?
- **Context**: Only single notification operations defined
- **Questions**:
  - Mark multiple as read?
  - Delete multiple notifications?
  - Bulk operations endpoint?

### 5. Notification Grouping
- **Question**: Can notifications be grouped or batched?
- **Context**: Not mentioned
- **Questions**:
  - Group by type?
  - Group by time period?
  - Batch similar notifications? (e.g., multiple oversized pages)

### 6. Notification Limits
- **Question**: Are there limits on notifications?
- **Context**: Not mentioned
- **Questions**:
  - Max notifications per user?
  - Max notifications per service call?
  - Rate limiting on sending notifications?

### 7. Notification Preferences (Basic)
- **Question**: Even for MVP, should users have basic preferences?
- **Context**: Mentioned as "future" but might need basics
- **Questions**:
  - Opt-out of certain notification types?
  - Email notifications? (even if not implemented, structure for it)
  - Quiet hours?

## Service Dependencies Questions

### 1. Service Discovery
- **Question**: How do services find each other?
- **Context**: Docs mention hardcoded URLs but not service discovery
- **Options**:
  - a) Hardcoded URLs in config (current approach)
  - b) Environment variables for service URLs
  - c) Service registry (future)
  - d) Docker Compose service names (for local dev)
- **Recommendation**: Option (b) + (d) - env vars with Docker service names

### 2. Health Checks
- **Question**: Do services have health check endpoints?
- **Context**: Not mentioned but important for monitoring
- **Questions**:
  - `GET /health` endpoint?
  - What does health check verify? (database, dependencies)
  - Used by Docker Compose health checks?
  - Used by load balancers?

### 3. Error Handling and Retries
- **Question**: How do services handle failures when calling other services?
- **Context**: Docs mention "non-blocking" but not retry logic
- **Questions**:
  - Retry failed requests? How many times?
  - Exponential backoff?
  - Circuit breaker pattern?
  - Timeout values?

### 4. Timeout Configuration
- **Question**: What are the timeout values for service-to-service calls?
- **Context**: Not mentioned
- **Questions**:
  - Connection timeout?
  - Read timeout?
  - Total request timeout?
  - Default: 5 seconds? 30 seconds?

### 5. Service Token Management
- **Question**: How are service tokens created and managed?
- **Context**: Mentioned but not detailed
- **Questions**:
  - Created during service setup?
  - Stored in environment variables?
  - Rotated periodically?
  - Managed by Auth Service?
  - One token per service? Or per service instance?

### 6. Database Schema Separation
- **Question**: How are database schemas organized?
- **Context**: Docs mention "separate schemas or table prefixes"
- **Questions**:
  - Separate PostgreSQL schemas? (`wiki`, `auth`, `notification`)
  - Table prefixes? (`wiki_pages`, `auth_users`)
  - Shared tables? (if any)
  - Migration strategy per service?

### 7. Shared Database Connection
- **Question**: How do services connect to shared database?
- **Context**: Docs mention shared database but not connection details
- **Questions**:
  - Connection pooling per service?
  - Max connections per service?
  - Database connection string in env vars?
  - Read replicas? (future)

## Summary

These questions need answers to make the service documentation complete and actionable. Once answered, I'll update the documentation with the specifics.
